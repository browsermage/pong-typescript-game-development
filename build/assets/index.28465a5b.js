var R=Object.defineProperty;var K=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var s=(t,e,i)=>(K(t,typeof e!="symbol"?e+"":e,i),i),m=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)};var c=(t,e,i)=>(m(t,e,"read from private field"),i?i.call(t):e.get(t)),p=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},S=(t,e,i,n)=>(m(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i);var f=(t,e,i)=>(m(t,e,"access private method"),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function i(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=i(o);fetch(o.href,r)}})();const M={},a={set(t,e){M[t]=e},get(t){return M[t]}};function v(t,e,i,n,o){const r=a.get("CanvasRenderer");r.context.save(),o&&(r.context.fillStyle=o),r.context.translate(t,e),r.context.fillRect(0,0,i,n),r.context.restore()}function g(t,e,i){const n=a.get("CanvasRenderer");n.context.fillStyle="white",n.context.textAlign="center",n.context.font="normal 12px Pong Font",n.context.fillText(t,e,i)}class E{constructor(e,i){s(this,"x");s(this,"y");this.x=e,this.y=i}set(e,i){this.x=Math.round(e),this.y=Math.round(i)}}function y(t,e){return Math.floor(Math.random()*(e-t+1)+t)}class T{}class b{constructor(){s(this,"position",new E(0,0))}}class P extends b{constructor(i,n){super();s(this,"speed",10);s(this,"time");s(this,"velocity",{y:0,x:0});this.position.set(i,n),this.time=a.get("Time"),this.resetVelocity()}render(){v(this.position.x,this.position.y,2,2,"white")}update(){this.position.x+=this.velocity.x*this.time.deltaTime,this.position.y+=this.velocity.y*this.time.deltaTime}resetVelocity(){this.velocity.x=Math.random()<.5?this.speed:-this.speed,this.velocity.y=Math.random()<.5?this.speed:-this.speed}reset(){this.position.set(22,14),this.resetVelocity()}collides(i){return!(this.position.x>i.position.x+2||i.position.x>this.position.x+2||this.position.y>i.position.y+6||i.position.y>this.position.y+2)}}class D extends b{constructor(i,n){super();s(this,"speed",50);s(this,"time");s(this,"velocity",{y:0,x:0});s(this,"direction",!1);this.position.set(i,n),this.time=a.get("Time"),setInterval(()=>this.direction=!this.direction,1e3)}render(){v(this.position.x,this.position.y,2,6,"white")}update(){this.direction?this.position.y=Math.min(16,this.position.y+10*this.time.deltaTime):this.position.y=Math.max(4,this.position.y+-10*this.time.deltaTime)}}class q extends b{constructor(i,n){super();s(this,"speed",50);s(this,"input");s(this,"time");s(this,"velocity",{y:0,x:0});this.position.set(i,n),this.input=a.get("Input"),this.time=a.get("Time")}render(){v(this.position.x,this.position.y,2,6,"white")}update(){this.input.getKeyDown("KeyW")?this.velocity.y=-this.speed:this.input.getKeyDown("KeyS")?this.velocity.y=this.speed:this.velocity.y=0,this.velocity.y<0?this.position.y=Math.max(4,this.position.y+this.velocity.y*this.time.deltaTime):this.position.y=Math.min(16,this.position.y+this.velocity.y*this.time.deltaTime)}}class C extends T{constructor(){super();s(this,"name","play");s(this,"player",new q(2,5));s(this,"computer",new D(42,16));s(this,"ball",new P(22,14));s(this,"score",{p1:0,p2:0});s(this,"sounds",[])}enter(){var i,n;(i=document.querySelector(".computer"))==null||i.setAttribute("data-animation-state","idle"),(n=document.querySelector("[data-audio='game-start']"))==null||n.play()}update(){var i,n,o,r,l,w;this.ball.update(),this.player.update(),this.computer.update(),this.ball.position.x<0&&((i=document.querySelector("[data-audio='win-sound']"))==null||i.play(),this.score.p2++,this.score.p2>=10?this.score={p1:0,p2:0}:this.ball.reset()),this.ball.position.x>42&&((n=document.querySelector("[data-audio='win-sound']"))==null||n.play(),this.score.p1++,this.score.p1>=10?this.score={p1:0,p2:0}:this.ball.reset()),this.ball.collides(this.player)&&(this.ball.velocity.x=-this.ball.velocity.x*1.1,this.ball.position.x=this.player.position.x+2,this.ball.velocity.y<0?this.ball.velocity.y=-y(22,50):this.ball.velocity.y=y(22,50),(o=document.querySelector("[data-audio='paddle-hit']"))==null||o.play()),this.ball.collides(this.computer)&&(this.ball.velocity.x=-this.ball.velocity.x*1.1,this.ball.position.x=this.computer.position.x-2,this.ball.velocity.y<0?this.ball.velocity.y=-y(22,50):this.ball.velocity.y=y(22,50),(r=document.querySelector("[data-audio='paddle-hit']"))==null||r.play()),this.ball.position.y<=2&&(this.ball.position.y=2,this.ball.velocity.y=-this.ball.velocity.y,(l=document.querySelector("[data-audio='wall-hit']"))==null||l.play()),this.ball.position.y>=22&&(this.ball.position.y=22,this.ball.velocity.y=-this.ball.velocity.y,(w=document.querySelector("[data-audio='wall-hit']"))==null||w.play())}render(){g(this.score.p1.toString(),17,12),g(this.score.p2.toString(),30,12),this.player.render(),this.computer.render(),this.ball.render()}exit(){var i;(i=document.querySelector(".computer"))==null||i.removeAttribute("data-animation-state")}}class A extends T{constructor(){super();s(this,"name","start");s(this,"input");s(this,"sceneManager");this.input=a.get("Input"),this.sceneManager=a.get("SceneManager")}enter(){}update(){!this.input||!this.sceneManager||this.input.getKeyPressed("Space")&&this.sceneManager.changeScene("play")}render(){g("PONG",23,16)}exit(){}}const L=t=>Reflect.has(t,"update"),z=t=>Reflect.has(t,"exit"),I=t=>Reflect.has(t,"enter"),N=t=>Reflect.has(t,"render");class O{constructor(e){s(this,"config",{resolution:{width:46,height:26}});s(this,"context");s(this,"canvas");this.canvas=e,this.canvas.style.imageRendering="pixelated",this.canvas.style.width=`${this.config.resolution.width}px`,this.canvas.style.height=`${this.config.resolution.height}px`,this.context=this.canvas.getContext("2d",{preserveDrawingBuffer:!0,desynchronized:!0,alpha:!0}),this.context.imageSmoothingEnabled=!1}reszie(){const e=window.devicePixelRatio;this.canvas.width=Math.floor(this.config.resolution.width*e),this.canvas.height=Math.floor(this.config.resolution.height*e),this.context.scale(e,e),this.context.imageSmoothingEnabled=!1}}class k{constructor(){s(this,"scenes",{});s(this,"current",{})}addScene(e,i){this.scenes[e]=i}changeScene(e,i={}){e in this.scenes&&(z(this.current)&&this.current.exit(),this.current=new this.scenes[e],I(this.current)&&this.current.enter(i))}}var h,d;class V{constructor(){s(this,"axis",{horizontal:0,vertical:0});p(this,h,{});p(this,d,{});document.addEventListener("keydown",e=>{c(this,h)[e.code]=!0,e.repeat||(c(this,d)[e.code]=!0)}),document.addEventListener("keyup",e=>{delete c(this,h)[e.code]})}getKeyPressed(e){return!!c(this,d)[e]}getKeyDown(e){return!!c(this,h)[e]}resetKeyPressedEvents(){S(this,d,{})}updateAxis(){this.axis={horizontal:0,vertical:0},this.getKeyDown("KeyD")&&(this.axis.horizontal=1),this.getKeyDown("KeyA")&&(this.axis.horizontal=-1),this.getKeyDown("KeyW")&&(this.axis.vertical=-1),this.getKeyDown("KeyS")&&(this.axis.vertical=1)}}h=new WeakMap,d=new WeakMap;class B{constructor(){s(this,"deltaTime",0);s(this,"lastTime",0);s(this,"elapsedTime",0);s(this,"maximumDeltaTime",.1)}}var u,x;class F extends HTMLCanvasElement{constructor(){super();p(this,u);s(this,"time");s(this,"input");s(this,"sceneManager");s(this,"canvasRenderer");a.set("Time",new B),a.set("Input",new V),a.set("SceneManager",new k),a.set("CanvasRenderer",new O(this)),this.time=a.get("Time"),this.input=a.get("Input"),this.sceneManager=a.get("SceneManager"),this.canvasRenderer=a.get("CanvasRenderer")}init(){this.start(),f(this,u,x).call(this)}}u=new WeakSet,x=function(i=0){this.canvasRenderer.reszie(),this.time.deltaTime=Number((i-this.time.lastTime)/1e3),this.time.deltaTime=Math.min(this.time.deltaTime,this.time.maximumDeltaTime),this.time.lastTime=i,this.time.elapsedTime+=this.time.deltaTime,this.input.updateAxis(),this.update(),L(this.sceneManager.current)&&this.sceneManager.current.update(),this.render(),N(this.sceneManager.current)&&this.sceneManager.current.render(),this.input.resetKeyPressedEvents(),window.requestAnimationFrame(n=>f(this,u,x).call(this,n))};class G extends F{constructor(){super(),this.init()}start(){this.sceneManager.addScene("play",C),this.sceneManager.addScene("start",A),this.sceneManager.changeScene("start")}render(){}update(){}}customElements.define("pong-game",G,{extends:"canvas"});
